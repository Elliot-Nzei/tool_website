## âœ… FULL PLAN: Dynamic Chart Implementation with Chart.js

---

### ğŸ“Œ OBJECTIVES

| Visualization       | Type      | Purpose                               |
| ------------------- | --------- | ------------------------------------- |
| Spending Categories | Pie Chart | Show expense distribution by category |
| Income vs. Expenses | Bar Chart | Compare total income and spending     |

---

## ğŸ§± FOLDER STRUCTURE (Front + Back)

```
project-root/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ models.py
â”‚   â””â”€â”€ utils/finance.py
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”‚   â””â”€â”€ js/
â”‚   â”‚       â””â”€â”€ script.js  âŸµ Chart logic goes here
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ finance.html  âŸµ Canvas containers added here
```

---

## ğŸ–¼ï¸ `finance.html` â€” Chart Containers + CDN

Place this in the section where summaries are rendered.

```html
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Financial Summary Section -->
<section class="financial-summary">
  <h2>ğŸ’¸ Monthly Financial Summary</h2>

  <!-- Canvas for Spending Breakdown -->
  <div class="chart-box">
    <h3>Spending Categories</h3>
    <canvas id="spendingChart"></canvas>
  </div>

  <!-- Canvas for Income vs Expenses -->
  <div class="chart-box">
    <h3>Income vs Expenses</h3>
    <canvas id="incomeExpenseChart"></canvas>
  </div>
</section>
```

---

## ğŸ¨ `style.css` â€” Optional Chart Styling

```css
.chart-box {
  margin: 2rem auto;
  max-width: 600px;
  background: var(--color-card);
  padding: 1rem;
  border-radius: 12px;
}
```

---

## âš™ï¸ `script.js` â€” Chart Rendering Logic

```js
// Render Spending Categories as Pie Chart
function renderSpendingChart(spendingData) {
  const ctx = document.getElementById('spendingChart').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: Object.keys(spendingData),
      datasets: [{
        data: Object.values(spendingData),
        backgroundColor: [
          '#ff6384', '#36a2eb', '#cc65fe', '#ffce56', '#009688', '#795548'
        ],
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' },
        tooltip: { callbacks: { label: (ctx) => `â‚¦${ctx.raw.toLocaleString()}` } }
      }
    }
  });
}

// Render Income vs Expenses Bar Chart
function renderIncomeVsExpenseChart(income, expense) {
  const ctx = document.getElementById('incomeExpenseChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Income', 'Expenses'],
      datasets: [{
        label: 'Amount',
        data: [income, expense],
        backgroundColor: ['#4caf50', '#f44336']
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true }
      },
      plugins: {
        legend: { display: false },
        tooltip: { callbacks: { label: (ctx) => `â‚¦${ctx.raw.toLocaleString()}` } }
      }
    }
  });
}
```

---

## ğŸ”— Integrating With API Response

After POSTing the CSV and receiving response in JS:

```js
// After fetch('/analyze') success
fetch('/analyze', { method: 'POST', body: formData })
  .then(res => res.json())
  .then(data => {
    renderSpendingChart(data.spending_breakdown);
    renderIncomeVsExpenseChart(data.total_income, data.total_expense);
    populateBreakdown(data); // reuse previous logic
  });
```

---

## âœ… PYTHON BACKEND (No changes needed)

If you followed the previous `analyze_bank_statement()` plan and added:

```python
"spending_breakdown": {
  "Rent": 75000.0,
  "Airtime": 10000.0,
  "Bills": 4000.0,
}
```

â€¦itâ€™s **already compatible** with Chart.js logic above.

---

## ğŸ§ª SAMPLE DATA FLOW

```json
{
  "total_income": 300000,
  "total_expense": 215000,
  "spending_breakdown": {
    "Rent": 75000,
    "Airtime": 10000,
    "Bills": 4000,
    "Mobile Data": 2000
  }
}
```

âœ… JS will render:

* Pie chart with Rent, Airtime, Bills, Data
* Bar chart: â‚¦300k vs â‚¦215k

---

## âœ… WHAT YOU NOW HAVE

| Feature                            | Status |
| ---------------------------------- | ------ |
| Chart.js Integrated                | âœ…      |
| Category Breakdown (Pie)           | âœ…      |
| Income vs Expense Comparison (Bar) | âœ…      |
| Data pulled from Python API        | âœ…      |
| Responsive Charts                  | âœ…      |

---

## ğŸ”„ NEXT OPTIONAL ENHANCEMENTS

1. ğŸ”§ Save charts as downloadable images (`chart.toBase64Image()`)
2. ğŸ“ˆ Add date filters (Last 30 days, 90 days)
3. ğŸ“‚ Generate a **PDF report** with summary + charts
4. ğŸ§  Let users customize categories manually

---

Brilliant move. Letâ€™s **fully integrate** the next level features:

---

# âœ… Phase 2: Final Enhancements (Charts + Export + Filters)

---

## âœ… 1. ğŸ“… **Date Range Filtering Logic**

This allows users to select a date range and dynamically filter financial data for that period.

### ğŸ§© HTML Input (Place in `finance.html`)

```html
<section class="filter-section">
  <label for="startDate">Start Date:</label>
  <input type="date" id="startDate" />

  <label for="endDate">End Date:</label>
  <input type="date" id="endDate" />

  <button id="filterBtn">Apply Filter</button>
</section>
```

### âš™ï¸ `script.js` Logic

```js
document.getElementById('filterBtn').onclick = () => {
  const start = document.getElementById('startDate').value;
  const end = document.getElementById('endDate').value;

  const formData = new FormData();
  formData.append('file', uploadedFile); // from your file input
  formData.append('start_date', start);
  formData.append('end_date', end);

  fetch('http://localhost:8000/analyze', {
    method: 'POST',
    body: formData
  })
    .then(res => res.json())
    .then(data => {
      renderSpendingChart(data.spending_breakdown);
      renderIncomeVsExpenseChart(data.total_income, data.total_expense);
    });
};
```

### ğŸ”§ Python Backend (`main.py`)

Add query support:

```python
from fastapi import Form
from datetime import datetime

@app.post("/analyze", response_model=FinancialSummary)
async def upload_and_analyze(
    file: UploadFile = File(...),
    start_date: str = Form(default=None),
    end_date: str = Form(default=None)
):
    file_path = f"{UPLOAD_DIR}/{file.filename}"
    with open(file_path, "wb") as buffer:
        shutil.copyfileobj(file.file, buffer)

    # Convert dates
    start = datetime.strptime(start_date, "%Y-%m-%d") if start_date else None
    end = datetime.strptime(end_date, "%Y-%m-%d") if end_date else None

    result = analyze_bank_statement(file_path, start, end)
    return result
```

Update `analyze_bank_statement()` in `finance.py` to filter the date range:

```python
def analyze_bank_statement(file_path: str, start: datetime = None, end: datetime = None) -> FinancialSummary:
    df = pd.read_csv(file_path)
    df['date'] = pd.to_datetime(df['date'])
    
    # Filter by range if provided
    if start:
        df = df[df['date'] >= start]
    if end:
        df = df[df['date'] <= end]

    # Continue as before...
```

---

## âœ… 2. ğŸŒ“ Dark Mode Chart Theming

Use CSS variables + JS sync.

### ğŸ§© CSS Variables

```css
:root {
  --color-bg: #ffffff;
  --color-text: #000000;
  --color-accent: #4caf50;
}

body.dark-mode {
  --color-bg: #121212;
  --color-text: #ffffff;
  --color-accent: #ff5722;
}
```

### âš™ï¸ Update `script.js` chart logic:

```js
function getThemeColors() {
  const isDark = document.body.classList.contains('dark-mode');
  return isDark
    ? ['#ff5722', '#03a9f4', '#ffeb3b', '#8bc34a', '#ff9800']
    : ['#4caf50', '#2196f3', '#ffc107', '#9c27b0', '#e91e63'];
}
```

Then pass into chart setup:

```js
backgroundColor: getThemeColors()
```

Also re-render on theme toggle:

```js
document.getElementById("darkToggle").onclick = () => {
  document.body.classList.toggle("dark-mode");
  rerenderAllCharts(); // custom function to redraw
};
```

---

## âœ… 3. ğŸ§¾ Export to PDF with `jsPDF`

### ğŸ§© HTML Button

```html
<button id="exportPDF">ğŸ“„ Export Report</button>
```

### ğŸ”— Add jsPDF via CDN

```html
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
```

### âš™ï¸ JS Logic

```js
document.getElementById('exportPDF').onclick = () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(16);
  doc.text("ğŸ’¼ Financial Summary Report", 20, 20);

  doc.setFontSize(12);
  doc.text(`Total Income: â‚¦${lastData.total_income.toLocaleString()}`, 20, 40);
  doc.text(`Total Expenses: â‚¦${lastData.total_expense.toLocaleString()}`, 20, 50);
  doc.text(`Net Savings: â‚¦${lastData.net_savings.toLocaleString()}`, 20, 60);

  doc.text("Top Spending Categories:", 20, 80);
  let y = 90;
  for (const [category, amount] of Object.entries(lastData.spending_breakdown)) {
    doc.text(`- ${category}: â‚¦${amount.toLocaleString()}`, 25, y);
    y += 10;
  }

  // Export as PDF
  doc.save("financial_report.pdf");
};
```

Use a `let lastData = {}` globally to store latest API result.

---

## âœ… Final Workflow Recap

| Feature           | âœ… Implemented |
| ----------------- | ------------- |
| ğŸ“Š Dynamic Charts | âœ…             |
| ğŸ“… Date Filtering | âœ…             |
| ğŸŒ“ Dark Mode Sync | âœ…             |
| ğŸ“„ PDF Export     | âœ…             |

---

## ğŸ§  Next-Level Suggestions

* Add **multi-month graph** (line chart over time)
* Allow **CSV export** of filtered data
* Include **user remarks or annotations** before exporting

